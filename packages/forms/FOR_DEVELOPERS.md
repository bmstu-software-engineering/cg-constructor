# Руководство для разработчиков пакета Forms

Этот документ содержит информацию для разработчиков, которые хотят внести свой вклад в развитие пакета Forms.

## Структура проекта

Пакет Forms состоит из нескольких частей:

- `lib/` - основная библиотека пакета
  - `src/` - исходный код пакета
    - `config/` - конфигурации полей и форм
    - `core/` - базовые классы и интерфейсы
    - `fields/` - реализации различных типов полей
    - `models/` - модели данных
    - `validators/` - валидаторы для полей
  - `widgets/` - виджеты для отображения полей и форм
- `packages/` - дополнительные пакеты
  - `forms_annotations/` - аннотации для генерации кода
  - `forms_generator/` - генератор кода для типизированных форм
- `test/` - тесты
  - `widget_tests/` - тесты виджетов

## Рабочий процесс разработки

### 1. Настройка окружения

Убедитесь, что у вас установлен Flutter и FVM (Flutter Version Management). Для установки зависимостей выполните:

```bash
fvm flutter pub get
```

### 2. Разработка

При разработке новых функций или исправлении ошибок следуйте этим рекомендациям:

- Создавайте отдельную ветку для каждой функции или исправления
- Следуйте стилю кода, принятому в проекте
- Добавляйте комментарии к коду, особенно для публичных API
- Пишите тесты для новых функций

### 3. Генерация кода

Пакет использует кодогенерацию для создания типизированных форм. Для запуска генерации кода используйте скрипт:

```bash
./codegen.sh
```

### 4. Тестирование

#### Обязательная валидация правок

**ВАЖНО**: Перед отправкой изменений обязательно выполните тесты и проверьте код линтером.

Для запуска тестов используйте:

```bash
./run_tests.sh
```

Этот скрипт запускает генерацию кода и выполняет все тесты. Все тесты должны проходить успешно.

Для проверки кода линтером используйте:

```bash
fvm flutter analyze .
```

Исправьте все предупреждения и ошибки, выявленные линтером.

### 5. Известные проблемы и особенности

#### Типы полей в списках

При работе с `ListField` важно учитывать, что тип поля для элементов списка всегда должен быть `FormField<T>`, а не конкретным типом поля (например, `NumberField`). Это связано с тем, что метод `createField` в классе `ListFieldConfig` создает поля с базовым типом `FormField<T>` для элементов списка.

В генераторе кода (`packages/forms_generator/lib/src/form_generator.dart`) метод `_getFieldType` должен всегда использовать базовый тип `FormField<T>` для всех типов элементов списка:

```dart
itemFieldType = 'FormField<$elementType>';
```

#### Валидация списков

Валидация списков включает проверку:
- Минимального и максимального количества элементов
- Валидацию каждого элемента списка

Убедитесь, что эти проверки работают корректно при внесении изменений в класс `ListField`.

## Отправка изменений

1. Убедитесь, что все тесты проходят успешно
2. Убедитесь, что код соответствует стандартам линтера
3. Создайте pull request с описанием изменений
4. Дождитесь ревью и одобрения изменений

## Выпуск новой версии

1. Обновите номер версии в `pubspec.yaml`
2. Обновите `CHANGELOG.md` с описанием изменений
3. Создайте тег с номером версии
4. Опубликуйте пакет в pub.dev:

```bash
fvm flutter pub publish
```
